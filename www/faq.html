<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<style type="text/css"> /* <![CDATA[ */
  @import "tigris-branding/css/tigris.css";
  @import "tigris-branding/css/inst.css";
  /* ]]> */</style>
<link rel="stylesheet" type="text/css" media="print"
  href="tigris-branding/css/print.css"/>
<script type="text/javascript" src="tigris-branding/scripts/tigris.js"></script>
<title>cvs2svn FAQ</title>
</head>

<body id="bodycol">
<div class="app">

<h1>cvs2svn FAQ</h1>

<p><strong>How-to:</strong></p>

<ol>

  <li><a href="#oneatatime">How can I convert my CVS repository one
    module at a time?</a></li>

  <li><a href="#partialconversion">How can I convert part of a CVS
    repository?</a></li>

  <li><a href="#onetoone">How can I convert separate projects in my
    CVS repository into a single Subversion repository?</a></li>

  <li><a href="#inverted">How can I convert project <tt>foo</tt> so
    that <tt>trunk/tags/branches</tt> are inside of
    <tt>foo</tt>?</a></li>

</ol>

<p><strong>Problems:</strong></p>

<ol>

  <li><a href="#atticprob">I get an error "A CVS repository cannot
    contain both repo/path/file.txt,v and
    repo/path/Attic/file.txt,v".  What can I do?</a></li>

  <li><a href="#rcsmissing">Using cvs2svn 1.3.x, I get an error "The
    command '['co', '-q', '-x,v', '-p1.1', '-kk',
    '/home/cvsroot/myfile,v']' failed" in pass 8.</a></li>

</ol>

<hr />

<h2>How-to:</h2>

<h3><a name="oneatatime" title="#oneatatime">How can I convert my CVS
repository one module at a time?</a></h3>

<p>If you need to convert certain CVS modules (in one large
repository) to Subversion <b>now</b> and other modules <b>later</b>,
you may want to convert your repository one module at a time.  This
situation is typically encountered in large organizations where each
project has a separate lifecycle and schedule, and a one-step
conversion process is not practical.
</p>

<p>First you have to decide whether you want to put your converted
projects into a single Subversion repositories or multiple ones.  This
decision mostly depends on the degree of coupling between the projects
and is beyond the scope of this FAQ.  See <a
href="http://svnbook.red-bean.com/en/1.2/svn.reposadmin.projects.html#svn.reposadmin.projects.chooselayout">the
Subversion book</a> for a discussion of repository organization.
</p>

<p>If you decide to convert your projects into separate Subversion
repositories, then please follow the instructions in <a
href="#partialconversion">How can I convert part of a CVS
repository?</a> once for each repository.

<p>If you decide to put more than one CVS project into a single
Subversion repository, then please follow the instructions in <a
href="#onetoone">How can I convert separate projects in my CVS
repository into a single Subversion repository?</a>.
</p>


<h3><a name="partialconversion" title="#partialconversion">How can I
convert part of a CVS repository?</a></h3>

<p>This is easy: simply run cvs2svn normally, passing it the path of
the project subdirectory within the CVS repository.  Since cvs2svn
ignores any files outside of the path it is given, other projects
within the CVS repository will be excluded from the conversion.
</p>

<p>Example: You have a CVS repository at path <tt>/path/cvsrepo</tt>
with projects in subdirectories <tt>/path/cvsrepo/foo</tt> and
<tt>/path/cvsrepo/bar</tt>, and you want to create a new Subversion
repository at <tt>/path/foo-svn</tt> that includes only the
<tt>foo</tt> project:

<pre>
    $ cvs2svn -s /path/foo-svn /path/cvsrepo/foo
</pre>

</p>


<h3><a name="onetoone" title="#onetoone">How can I convert separate
projects in my CVS repository into a single Subversion
repository?</a></h3>

<p>To convert multiple projects from a single CVS repository into a
single Subversion repository, then you have to use cvs2svn once for
each project, storing the output into a "dumpfile".  Then you use
<tt>svnadmin</tt> to load each dumpfile, one after the other, into a
project directory created within the Subversion repository.
</p>

<p><b>NOTE:</b> importing projects one at a time
into a single Subversion repository will likely break date-based range
commands (e.g. <tt>svn diff -r {2002-02-17:2002-03-18}</tt>) since
Subversion does a binary search through the repository to look for
dates.  While this is not the end of the world, it can be a minor
inconvenience.
</p>

<p>Example:
</p>

<ol>
  <li>If the svn repository doesn't already exist, create it:
    <pre>
      svnadmin create /path/to/svnrepos
    </pre></li>

  <li>Remember to <b>Make a backup</b> before starting.  Never run
    cvs2svn on a live CVS repository--always work on a copy of your
    repository.</li>

  <li>Run cvs2svn against one of the modules you want converted:
    <pre>
      # Copy the CVS modules into a temporary cvs repository.
      # This is not absolutely necessary, but it's for safety's sake.
      $ mkdir ~/newcvsrepo
      $ mkdir ~/newcvsrepo/CVSROOT # needed by cvs2svn --use-cvs
      $ cp -r /oldcvsrepo/projectA ~/newcvsrepo

      # Create a dumpfile containing the new CVS repository contents
      $ mkdir ~/svndump; cd ~/svndump
      $ cvs2svn --dump-only ~/newcvsrepo/projectA
    </pre></li>


  <li>Import the dump into the Subversion repository:
    <pre>
      # Make a directory for the project.
      $ svn mkdir file:///path/to/svnrepos/projectA -m "Added projectA directory."

      # Use "svnadmin load" to load the dumpfile.
      $ cd ~/svndump
      $ svnadmin --parent-dir projectA load /path/to/svnrepos &lt; cvs2svn-dump
    </pre></li>

  <li>Repeat steps 3 and 4 for each module you want to convert.</li>

</ol>


<h3><a name="inverted" title="#inverted">How can I convert project
    <tt>foo</tt> so that <tt>trunk/tags/branches</tt> are inside of
    <tt>foo</tt>?</a></h3>

  <p>Given a CVS repository with the layout:</p>

<pre>
  /project_a
  /project_b
</pre>

  <p>cvs2svn will produce a Subversion repository with the following
    layout:</p>

<pre>
   trunk/
      project_a/
         ...
      project_b/
         ...
   tags/
      ...
   branches/
      ...
</pre>

  <p>However, you may want your Subversion repository to be laid out
    like this:</p>

<pre>
   project_a/
      trunk/
         ...
      branches/
         ...
      tags/
         ...
   project_b/
      trunk/
         ...
      branches/
         ...
      tags/
         ...
</pre>

  <p>Currently, cvs2svn does not support converting a repository in
    this manner (see <a
    href="http://cvs2svn.tigris.org/issues/show_bug.cgi?id=86">Issue
    #86</a> for details), however, there is a workaround.  You can
    convert your repository one project (or module) at a time and load
    the individual dumpfiles into your Subversion repository using
    <tt>svnadmin</tt> with the <tt>--parent-dir</tt> switch.  See the
    answer to <a href="#oneatatime">How can I convert my CVS
    repository one module at a time?</a> for details.</p>

<hr />

<h2>Problems:</h2>

<h3><a name="atticprob" title="#atticprob">I get an error "A CVS
    repository cannot contain both repo/path/file.txt,v and
    repo/path/Attic/file.txt,v".  What can I do?</a></h3>

<p>Background: Normally, if you have a file called
<tt>path/file.txt</tt> in your project, CVS stores its history in a
file called <tt>repo/path/file.txt,v</tt>.  But if <tt>file.txt</tt>
is deleted on the main line of development, CVS moves its history file
to a special <tt>Attic</tt> subdirectory:
<tt>repo/path/Attic/file.txt,v</tt>.  (If the file is recreated, then
it is moved back out of the <tt>Attic</tt> subdirectory.)  Your
repository should never contain both of these files at the same
time.</p>

<p>This cvs2svn error message thus indicates a mild form of corruption
in your CVS repository.  The file has two conflicting histories, and
even CVS does not know the correct history of <tt>path/file.txt</tt>.
The corruption was probably created by using tools other than CVS to
backup or manipulate the files in your repository.  With a little work
you can learn more about the two histories by viewing each of the
<tt>file.txt,v</tt> files in a text editor.</p>

<p>There are four straightforward approaches to fixing the repository
corruption, but each has potential disadvantages.  Remember to <b>make
a backup</b> before starting.  Never run cvs2svn on a live CVS
repository--always work on a copy of your repository.</p>

<ol>
  <li>Remove the <tt>Attic</tt> version of the file and restart the
    conversion.  Sometimes it represents an old version of the file
    that was deleted long ago, and it won't be missed.  But this
    completely discards one of the file's histories, probably causing
    <tt>file.txt</tt> to be missing in older historical revisions.
    (For what it's worth, this is probably how CVS would behave in
    this situation.)

    <pre>
      # You did make a backup, right?
      $ rm repo/path/Attic/file.txt,v
    </pre></li>

  <li>Remove the non-<tt>Attic</tt> version of the file and restart
    the conversion.  This might be appropriate if the
    non-<tt>Attic</tt> version has less important content than the
    <tt>Attic</tt> version.  But this completely discards one of the
    file's histories, probably causing <tt>file.txt</tt> to be missing
    in recent historical revisions.

    <pre>
      # You did make a backup, right?
      $ rm repo/path/file.txt,v
    </pre></li>

  <li>Rename the <tt>Attic</tt> version of the file and restart the
    conversion.  This avoids losing history, but it changes the name
    of the <tt>Attic</tt> version of the file to
    <tt>file-from-Attic.txt</tt> whenever it appeared, and might
    thereby cause revisions to be broken.

    <pre>
      # You did make a backup, right?
      $ mv repo/path/Attic/file.txt,v repo/path/Attic/file-from-Attic.txt,v
    </pre></li>

  <li>Rename the non-<tt>Attic</tt> version of the file and restart
    the conversion.  This avoids losing history, but it changes the
    name of the non-<tt>Attic</tt> version of the file to
    <tt>file-not-from-Attic.txt</tt> whenever it appeared, and might
    thereby cause revisions to be broken.

    <pre>
      # You did make a backup, right?
      $ mv repo/path/file.txt,v repo/path/file-not-from-Attic.txt,v
    </pre></li>

</ol>


<h3><a name="rcsmissing" title="#installrcs">Using cvs2svn 1.3.x, I
    get an error "The command '['co', '-q', '-x,v', '-p1.1', '-kk',
    '/home/cvsroot/myfile,v']' failed" in pass 8.</a></h3>

<p>By default, cvs2svn uses the "co" program from RCS to read the
contents of files in your archive.  (See the <a
href="cvs2svn.html#reqs">requirements</a> section of the
documentation.)  The solution to this problem is either to install
RCS, or to ensure that CVS is installed and use cvs2svn's
<a href="cvs2svn.html#use-cvs"><tt>--use-cvs</tt></a> option.
</p>

</div>
</body>
</html>
